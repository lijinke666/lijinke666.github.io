<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="æé‡‘ç‚,jinke.li666@gmail.com"><title>Canvas æ–‡æœ¬æ¸²æŸ“é‚£äº›äº‹ Â· æé‡‘ç‚çš„å°å±‹</title><meta name="description" content="èƒŒæ™¯åœ¨è¡¨æ ¼ç»†åˆ†é¢†åŸŸä¸­ï¼Œä¸»è¦çš„æŠ€æœ¯å®ç°åˆ†ä¸º DOM å’Œ Canvas, æ»¡è¶³ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå„æœ‰ä¼˜åŠ£ï¼ŒDOM æ›´çµæ´»æ›´æ–¹ä¾¿ï¼Œå¾ˆå¤šäº‹æƒ…æµè§ˆå™¨æ¸²æŸ“å¼•æ“å·²ç»å¸®ä½ å¤„ç†å¥½äº†ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œäº¤äº’å®ç°ä¸çµæ´»ï¼ŒCanvas è§£å†³äº† DOM çš„ç¼ºç‚¹ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥æ›´é«˜çš„ä¸Šæ‰‹æˆæœ¬å’Œå¼€å‘éš¾åº¦ï¼Œæœ¬æ–‡å°±ç€é‡è®²è§£ä½¿ç”¨ Canvas"><meta name="keywords" content="Javascript,Node.js"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="æé‡‘ç‚çš„å°å±‹"><meta name="icon" content="/logos/logo_192.png"><meta name="apple-touch-icon" content="/logos/logo_192.png"><meta name="apple-touch-icon-precomposed" content="/logos/logo_192.png"><meta name="apple-touch-startup-image" content="/logos/logo_192.png"><meta name="Alipay:title" content="æé‡‘ç‚çš„å°å±‹"><meta name="Alipay:imgUrl" content="/logos/logo_192.png"><meta name="Alipay:desc" content="è¦æƒ³å­¦ä»™æœ¯å“ªèƒ½ä¸åƒè‹¦"><meta name="renderer" content="webkit"><meta name="theme-color" content="#fff"><link rel="short icon" href="/logos/logo_192.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="manifest" href="/manifest.json"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/my.jpeg" style="width:127px;border-radius:50%;margin-bottom:20px;"><h3 title=""><a href="/">æé‡‘ç‚çš„å°å±‹</a></h3><div class="description"><p>è¦æƒ³å­¦ä»™æœ¯,å“ªèƒ½ä¸åƒè‹¦</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="http://weibo.com/é‡‘ç‚ç‚ç‚ç‚"><i class="fa fa-weibo"></i></a></li><li><a target="_blank" rel="noopener" href="http://github.com/lijinke666"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by</span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai</a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a><a href="https://beian.miit.gov.cn/" target="_blank">èœ€ICPå¤‡17033638å·</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">ä¸»é¡µ</a></li><li><a href="/about">å…³äº</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/links">å‹æƒ…é“¾æ¥</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/my.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Canvas æ–‡æœ¬æ¸²æŸ“é‚£äº›äº‹</a></h3></div><div class="post-content"><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨è¡¨æ ¼ç»†åˆ†é¢†åŸŸä¸­ï¼Œä¸»è¦çš„æŠ€æœ¯å®ç°åˆ†ä¸º DOM å’Œ Canvas, æ»¡è¶³ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå„æœ‰ä¼˜åŠ£ï¼ŒDOM æ›´çµæ´»æ›´æ–¹ä¾¿ï¼Œå¾ˆå¤šäº‹æƒ…æµè§ˆå™¨æ¸²æŸ“å¼•æ“å·²ç»å¸®ä½ å¤„ç†å¥½äº†ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œäº¤äº’å®ç°ä¸çµæ´»ï¼ŒCanvas è§£å†³äº† DOM çš„ç¼ºç‚¹ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥æ›´é«˜çš„ä¸Šæ‰‹æˆæœ¬å’Œå¼€å‘éš¾åº¦ï¼Œæœ¬æ–‡å°±ç€é‡è®²è§£ä½¿ç”¨ Canvas å®ç° S2 è¡¨æ ¼åœ¨æ–‡æœ¬æ¸²æŸ“ä¸Šé‡åˆ°çš„é‚£äº›äº‹ã€‚</p>
<h3 id="GgCc9">è®©æ–‡æœ¬æ¸²æŸ“æ›´æ¸…æ™°</h3>

<p><code>DPR</code>æ˜¯ â€œDevice Pixel Ratioâ€ï¼ˆè®¾å¤‡åƒç´ æ¯”ï¼‰çš„ç¼©å†™ï¼ŒæŒ‡çš„æ˜¯ç‰©ç†åƒç´ å’Œè®¾å¤‡ç‹¬ç«‹åƒç´ çš„æ¯”ç‡ï¼Œä¸åŒçš„å±å¹• <code>DPR</code>ä¹Ÿä¸åŒï¼Œåƒæˆ‘ä»¬å¹³æ—¶ç”¨çš„ <strong>2k å¤–æ¥å± DPR</strong> æ˜¯ <code>1</code>, <strong>Mac è§†ç½‘è†œå±å¹•</strong> DPR æ˜¯ <code>2</code>.</p>
<table>
<thead>
<tr>
<th><img src="/images/2024-12-31-e0289d921ef67c663564ffe0d9094560667c799c1a86a3c408e973d0369ee454.png" alt="å›¾ 0"></th>
<th><img src="/images/2024-12-31-34d9147a43aea40955c2db4743c0c835bc1f5ce19662ba2fc8d96d553d2833c7.png" alt="å›¾ 1"></th>
</tr>
</thead>
</table>
<p>åœ¨ Canvas ä¸­éœ€è¦é¢å¤–é€‚é…ï¼Œä¸ç„¶æ–‡æœ¬ï¼Œå›¾å½¢ç­‰åœºæ™¯ä¼šæ¨¡ç³Šï¼Œä¹Ÿå°±æ˜¯å°† <code>canvas</code> çš„å®½é«˜æ”¾å¤§ n å€ (n = DPR)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;your-canvas-id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dpr = <span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> rect = canvas.getBoundingClientRect();</span><br><span class="line">canvas.width = rect.width * dpr;</span><br><span class="line">canvas.height = rect.height * dpr;</span><br><span class="line">ctx.scale(dpr, dpr);</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.fillText(<span class="string">&#x27;å“ˆå“ˆ&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>:::warning<br>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ <code>canvas.style.width</code> å’Œ <code>canvas.width</code> æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªæ˜¯ Canvas DOM èŠ‚ç‚¹çš„ <code>width</code> å±æ€§ï¼Œä¸€ä¸ªæ˜¯ CSS æ ·å¼ï¼Œæœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚é«˜æ¸…é€‚é…æ”¹å˜çš„æ˜¯ <code>canvas.width</code>, æ‰€ä»¥ DOM çš„å°ºå¯¸æ˜¯ä¸å˜çš„ï¼Œ<strong>ä¸ä¼šå½±å“é¡µé¢å¸ƒå±€ã€‚</strong></p>
<p>:::</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">canvas.style.width = xxx</span><br><span class="line">canvas.width = xxx</span><br></pre></td></tr></table></figure>

<p><img src="/images/2024-12-31-fd656246784f5ff2f918c4b0a3e073c32b0fdc13c2d3f3ee5a48988ce02ca9b6.png" alt="å›¾ 2"></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ <strong>DPR åˆ‡æ¢çš„åœºæ™¯ï¼Œ</strong>æ¯”å¦‚ç”¨æˆ·å°†æµè§ˆå™¨ä» 2K æ˜¾ç¤ºå™¨ç§»åŠ¨åˆ°çš„å¦å¤–ä¸€ä¸ª 4K çš„æ˜¾ç¤ºå™¨ ğŸ–¥, ç”±äº Canvas æ˜¯æŒ‰ç…§ç§»åŠ¨å‰çš„å±å¹• DPR è¿›è¡Œçš„é€‚é…ï¼Œæ‰€ä»¥ä¹Ÿä¼šæœ‰æ¨¡ç³Šçš„é—®é¢˜ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯é€šè¿‡ <code>matchMedia</code> å¯¹ DPR è¿›è¡Œç›‘å¬ï¼Œé‡æ–°æ›´æ–° <code>canvas.width/height</code> å³å¯ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// devicePixelRatio: 1</span></span><br><span class="line"><span class="keyword">const</span> media = <span class="built_in">window</span>.matchMedia(<span class="string">`(resolution: <span class="subst">$&#123;<span class="built_in">window</span>.devicePixelRatio&#125;</span>dppx)`</span>);</span><br><span class="line"></span><br><span class="line">media.addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dpr = <span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>; <span class="comment">// devicePixelRatio: 2</span></span><br><span class="line"></span><br><span class="line">  canvas.width = rect.width * dpr;</span><br><span class="line">  canvas.height = rect.height * dpr;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Xw9wh">æ–‡æœ¬æ’ç‰ˆä¸æ¢è¡Œ</h3>

<h4 id="BafmC">æ’ç‰ˆ</h4>

<p>åœ¨ Canvas ä¸­è¦è¿›è¡Œæ–‡å­—çš„æ’ç‰ˆå’Œæ¢è¡Œå¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œå¦‚æœæ˜¯ DOM, æˆ‘ä»¬é€šè¿‡ç¼–å†™ç®€å•çš„ <code>CSS</code> å°±å¯ä»¥å®ç°å¸ƒå±€ï¼Œæµè§ˆå™¨å·²ç»å¸®æˆ‘ä»¬è®¡ç®—å¥½äº†ä¸€åˆ‡ï¼Œä½†åœ¨ Canvas ç”»æ¿ä¸­ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ˜¯éœ€è¦è‡ªå·±è®¡ç®—çš„ï¼Œæ–‡æœ¬ (Text), è¾¹æ¡† (Line), å•å…ƒæ ¼ (Rect) æ‰€æœ‰çš„ä¸€åˆ‡ã€‚å¯ä»¥ç†è§£æ‰€æœ‰å…ƒç´ éƒ½æ˜¯<strong>ç»å¯¹å®šä½</strong>, è¦æ‰‹åŠ¨æ§åˆ¶æ‰€æœ‰å…ƒç´ çš„ <code>top/right/bottom/left</code></p>
<p><img src="/images/2024-12-31-9b2849373160cedc205fa4b621cc411de776bf997fbf31b52630a13a86c27d64.png" alt="å›¾ 3"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æƒ³ç»˜åˆ¶ä¸€ä¸ª <code>æ•°é‡</code> å•å…ƒæ ¼ï¼Œæ–‡æœ¬çš„å³è¾¹ï¼Œéœ€è¦ç»˜åˆ¶ä¸€ä¸ª <code>â–½</code> æ’åº icon, ç®€åŒ–çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>è®¡ç®—å‡ºå•å…ƒæ ¼çš„ç›’æ¨¡å‹ (BBox), ç±»ä¼¼ä¸æµè§ˆå™¨é‚£æ ·</li>
<li>è®¡ç®—å‡ºå•å…ƒæ ¼çš„å®½é«˜å’Œåæ ‡ (x: 200, y: 100, width: 100, height: 30)</li>
<li>è®¡ç®—å‡º <code>æ•°é‡</code> æ–‡æœ¬çš„å®½åº¦ï¼Œè€ƒè™‘æ–‡å­—çš„å¯¹é½æ–¹å¼ ï¼ˆé å·¦/å±…ä¸­/é å³ï¼‰ åï¼Œè®¡ç®—æ–‡æœ¬åæ ‡</li>
<li>è®¡ç®—å‡º <code>â–½</code> icon çš„å®½é«˜ï¼Œè€ƒè™‘æ–‡æœ¬çš„ margin å’Œ padding åï¼Œè®¡ç®— icon åæ ‡</li>
</ul>
<p><img src="/images/2024-12-31-451a23757b3f315f55eab8f0181fb0a5536fc7f9e91ebabda4e3077aa158801c.png" alt="å›¾ 6"></p>
<p>ç”±äºè¿˜æœ‰æ»šåŠ¨çš„åœºæ™¯ï¼Œæ‰€ä»¥è¿˜éœ€è¦é¢å¤–è€ƒè™‘åæ ‡çš„åŒæ­¥</p>
<p><img src="/images/2024-12-31-e29223c2b4c6fa85e821091c7da86bb8b12643724cd8fde11968fb36e7edfbb4.png" alt="å›¾ 7"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/antvis/S2/blob/a09d1fe0507a566f154a407c92f13ff48beafc99/packages/s2-core/src/cell/header-cell.ts#L48">S2/packages/s2-core/src/cell/header-cell.ts at a09d1fe0507a566f154a407c92f13ff48beafc99 Â· antvis/S2</a></p>
<p>å¯¹äº S2 è¿™ç§å•å…ƒæ ¼å¸ƒå±€çš„åœºæ™¯ï¼Œå¦‚æœèƒ½åƒ CSS é‚£æ ·ä½¿ç”¨ <code>flex</code> æˆ–è€… <code>grid</code>å¸ƒå±€å°±éå¸¸çš„é«˜æ•ˆäº†ï¼Œäº‹å®ä¸Šï¼Œ<font style="color:rgba(0, 0, 0, 0.85);">Facebook (Meta) æä¾›äº†è·¨å¹³å°å¸ƒå±€å¼•æ“ä¸€ä¸ª </font><a target="_blank" rel="noopener" href="https://yogalayout.com/"><font style="color:rgba(0, 0, 0, 0.85);">Yoga</font></a><font style="color:rgba(0, 0, 0, 0.85);">, å¯ä»¥å®ç°ç±»ä¼¼çš„æ•ˆæœï¼Œå¦‚æœå†™è¿‡ </font><code>&lt;font style=&quot;color:rgba(0, 0, 0, 0.85);&quot;&gt;React Native&lt;/font&gt;</code><font style="color:rgba(0, 0, 0, 0.85);">çš„åŒå­¦è‚¯å®šä¼šå¾ˆç†Ÿæ‚‰ </font></p>
<p><img src="/images/2024-12-31-4f1181e23cc323234bf2418a747aa49b496c333a0d0df5bdb05a036482ef6a2f.png" alt="å›¾ 8"></p>
<p><code>AntV/G 5.0</code> ä¹Ÿå°è£…äº†ç›¸åº”çš„æ’ä»¶ <code>[g-plugin-yoga](https://g.antv.antgroup.com/plugins/yoga)</code> ä¸è¿‡ç”±äºå†å²åŸå› å’Œå‡çº§æˆæœ¬çš„é—®é¢˜ï¼ŒS2 æ²¡æœ‰è¿ç§»åˆ°è¯¥æ–¹æ¡ˆã€‚</p>
<p><img src="/images/2024-12-31-738bd90dfeb0bfc6ee9bc77d5b2556de8187a2bfd892b977cc849f0c8cd9e327.png" alt="å›¾ 9"></p>
<h4 id="iolbI">æ–‡æœ¬çœç•¥</h4>

<p>è§£å†³äº†æ’ç‰ˆçš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ–‡æœ¬çœç•¥çš„åœºæ™¯ï¼Œåœ¨ CSS ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº† <code>text-overflow: ellipsis</code> å’Œ <code>overflow: hidden</code> é‚£ä¹ˆæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨çœç•¥æ–‡æœ¬ï¼Œå¹¶å·² <code>...</code> å±•ç¤º</p>
<p><img src="/images/2024-12-31-cef85a51127f058bb144ed03f33f66b0ca722c06cc1ec58260cd4283fee5e672.png" alt="å›¾ 10"></p>
<p>å¯¹äº S2 çš„è¡¨æ ¼åœºæ™¯ï¼Œå•å…ƒæ ¼çš„å®½åº¦æ˜¯å›ºå®šçš„ï¼Œå¹¶é»˜è®¤å°±æ˜¯æº¢å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—æ˜¯å¦éœ€è¦å±•ç¤ºçœç•¥å·</p>
<p><img src="/images/2024-12-31-68da122f90460a708024a14564b405de12fd67aa099156933d5ef5f16a2d64bc.png" alt="å›¾ 11"></p>
<p>å…·ä½“çš„å®ç°æ„Ÿå…´è¶£å¯ä»¥æŸ¥çœ‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/antvis/S2/blob/ab0d0e768cf627249b38205b8c77d95a20b3a901/packages/s2-core/src/utils/text.ts#L193-L289">S2/packages/s2-core/src/utils/text.ts at ab0d0e768cf627249b38205b8c77d95a20b3a901 Â· antvis/S2</a></p>
<p>:::info<br>ä¸€ä¸ªæœ‰è¶£çš„ç‚¹æ˜¯ï¼šæŒ‰ç…§æµè§ˆå™¨çš„è§„èŒƒï¼Œå½“ç»™å®šçš„å®½åº¦è¿çœç•¥å·éƒ½ä¸è¶³ä»¥å±•ç¤ºçš„è¯ï¼Œä¼šç›´æ¥å¯¹æ–‡å­—è¿›è¡Œæˆªæ–­ï¼Œè€Œä¸æ˜¯æ˜¾ç¤º <code>...</code></p>
<p>:::</p>
<p><img src="/images/2024-12-31-1609f09856339f058ab06c7391a0430e122facaa1fde3d78cdf37732e41a48e2.png" alt="å›¾ 12"></p>
<h4 id="d90Ay">å¤šè¡Œæ–‡æœ¬</h4>

<p><img src="/images/2024-12-31-770fad79165199f549a4350c3a923a9dae186d551a680a03618589795c0ffda7.png" alt="å›¾ 13"></p>
<p>åœ¨ CSS ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>line-clamp</code> å®ç°å¤šè¡Œæ–‡æœ¬</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">display</span>: -webkit-box;</span><br><span class="line">-webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">-webkit-box-orient: vertical;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº S2 çš„è¡¨æ ¼åœºæ™¯ï¼Œå•å…ƒæ ¼çš„å®½åº¦æ˜¯å›ºå®šçš„ï¼Œä»¥æ¢ä¸¤è¡Œä¸ºä¾‹ï¼š</p>
<ol>
<li>é¦–å…ˆè®¡ç®—å½“å‰æ–‡æœ¬æ˜¯å¦å­˜åœ¨çœç•¥å·</li>
<li>å¦‚æœå­˜åœ¨çœç•¥å·ï¼Œè¯´æ˜ä¸€è¡Œæ–‡å­—æ˜¾ç¤ºä¸ä¸‹ï¼Œé‚£ä¹ˆè¿›è¡Œåˆ†è¯</li>
<li>åˆ†è¯åï¼Œå¯¹ç¬¬äºŒè¡Œçš„æ–‡å­—è¿›è¡Œç›¸åŒçš„æ“ä½œï¼Œç¬¬ n è¡Œä¾æ¬¡ç±»æ¨</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="title">drawTextShape</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; x &#125; = <span class="built_in">this</span>.getContentArea();</span><br><span class="line">    <span class="keyword">const</span> &#123; y, height &#125; = <span class="built_in">this</span>.getCellArea();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> textStyle = <span class="built_in">this</span>.getTextStyle();</span><br><span class="line">    <span class="keyword">const</span> cornerText = <span class="built_in">this</span>.getCornerText();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ä¸ºæ ‘çŠ¶ç»“æ„ä¸‹éœ€è¦è®¡ç®—æ–‡æœ¬å‰æ”¶èµ·å±•å¼€çš„ icon å çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> maxWidth = <span class="built_in">this</span>.getMaxTextWidth();</span><br><span class="line">    <span class="keyword">const</span> emptyPlaceholder = getEmptyPlaceholder(</span><br><span class="line">      <span class="built_in">this</span>.meta,</span><br><span class="line">      <span class="built_in">this</span>.spreadsheet.options.placeholder,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> &#123; measureTextWidth &#125; = <span class="built_in">this</span>.spreadsheet;</span><br><span class="line">    <span class="keyword">const</span> text = getEllipsisText(&#123;</span><br><span class="line">      measureTextWidth,</span><br><span class="line">      <span class="attr">text</span>: cornerText,</span><br><span class="line">      maxWidth,</span><br><span class="line">      <span class="attr">fontParam</span>: textStyle,</span><br><span class="line">      <span class="attr">placeholder</span>: emptyPlaceholder,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.actualText = text;</span><br><span class="line">    <span class="keyword">const</span> ellipseIndex = text.indexOf(ELLIPSIS_SYMBOL);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> firstLine = text;</span><br><span class="line">    <span class="keyword">let</span> secondLine = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜åœ¨æ–‡å­—çš„çœç•¥å· &amp; å±•ç¤ºä¸º tree ç»“æ„</span></span><br><span class="line">    <span class="keyword">if</span> (ellipseIndex !== -<span class="number">1</span> &amp;&amp; <span class="built_in">this</span>.spreadsheet.isHierarchyTreeType()) &#123;</span><br><span class="line">      <span class="comment">// å‰ªè£åˆ° ... æœ€æœ‰ç‚¹çš„å 1 ä¸ªåƒç´ ä½ç½®</span></span><br><span class="line">      <span class="keyword">const</span> lastIndex = ellipseIndex + (isIPhoneX() ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">      firstLine = cornerText.substr(<span class="number">0</span>, lastIndex);</span><br><span class="line">      secondLine = cornerText.slice(lastIndex);</span><br><span class="line">      <span class="comment">// ç¬¬äºŒè¡Œé‡æ–°è®¡ç®—ã€‚.. é€»è¾‘</span></span><br><span class="line">      secondLine = getEllipsisText(&#123;</span><br><span class="line">        measureTextWidth,</span><br><span class="line">        <span class="attr">text</span>: secondLine,</span><br><span class="line">        maxWidth,</span><br><span class="line">        <span class="attr">fontParam</span>: textStyle,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">x</span>: textX &#125; = getTextPosition(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">x</span>: x + <span class="built_in">this</span>.getTreeIconWidth(),</span><br><span class="line">        y,</span><br><span class="line">        <span class="attr">width</span>: maxWidth,</span><br><span class="line">        height,</span><br><span class="line">      &#125;,</span><br><span class="line">      textStyle,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> textY = y + (isEmpty(secondLine) ? height / <span class="number">2</span> : height / <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// first line</span></span><br><span class="line">    <span class="built_in">this</span>.addTextShape(</span><br><span class="line">      renderText(</span><br><span class="line">        <span class="built_in">this</span>,</span><br><span class="line">        [<span class="built_in">this</span>.textShapes[<span class="number">0</span>]],</span><br><span class="line">        textX,</span><br><span class="line">        textY,</span><br><span class="line">        firstLine,</span><br><span class="line">        textStyle,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// second line</span></span><br><span class="line">    <span class="keyword">if</span> (!isEmpty(secondLine)) &#123;</span><br><span class="line">      <span class="built_in">this</span>.addTextShape(</span><br><span class="line">        renderText(</span><br><span class="line">          <span class="built_in">this</span>,</span><br><span class="line">          [<span class="built_in">this</span>.textShapes[<span class="number">1</span>]],</span><br><span class="line">          textX,</span><br><span class="line">          y + height * <span class="number">0.75</span>,</span><br><span class="line">          secondLine,</span><br><span class="line">          textStyle,</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.actualTextWidth = max([</span><br><span class="line">      measureTextWidth(firstLine, textStyle),</span><br><span class="line">      measureTextWidth(secondLine, textStyle),</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/antvis/S2/blob/ab0d0e768cf627249b38205b8c77d95a20b3a901/packages/s2-core/src/cell/corner-cell.ts#L76-L160">S2/packages/s2-core/src/cell/corner-cell.ts at ab0d0e768cf627249b38205b8c77d95a20b3a901 Â· antvis/S2</a></p>
<p>åœ¨ S2 2.0 ä¸­ï¼Œå¾—ç›Šä¸ G 5.0 æ¸²æŸ“å¼•æ“çš„å‡çº§ï¼Œå†…ç½®äº†å¤šè¡Œæ–‡æœ¬çš„èƒ½åŠ›ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/antvis/G/blob/ee938ca12ac343d0506b7fa41bbd27d92fdd4d28/packages/g-lite/src/services/TextService.ts#L345">G/packages/g-lite/src/services/TextService.ts at ee938ca12ac343d0506b7fa41bbd27d92fdd4d28 Â· antvis/G</a></p>
<h3 id="BBofT">æ–‡æœ¬æŠ—é”¯é½¿</h3>

<p>åœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ° <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/442816681">å‚ç›´åŒæ­¥ã€åŠ¨æ€æ¨¡ç³Šã€æŠ—é”¯é½¿</a> è¿™äº›å…³é”®è¯</p>
<p><img src="/images/2024-12-31-b653367d2b809d9c2d4fee33c0d343889aa61c49ca72409fa73cfb17e8a9e176.png" alt="å›¾ 14"></p>
<p>å…¶ä¸­æŠ—é”¯é½¿ä¸­çš„ â€œé”¯é½¿â€ å°±åƒä¸‹å›¾ä¸€æ ·</p>
<p><img src="/images/2024-12-31-575a9ccd7b03d7fbfb1e42678eecf43d1885a2fb77fd2716849a6e7dc2b1f51a.png" alt="å›¾ 15"></p>
<p>å¦‚æœç”¨è¿‡ Windows â€œä¸çŸ¥åè½¯ä»¶â€ - â€œç”»å›¾â€ çš„è¯ï¼Œç”»ä¸€æ¡çº¿å°±ä¼šçœ‹åˆ°ä¸‹é¢è¿™æ ·</p>
<p><img src="/images/2024-12-31-4bc3e9bcc6b05291c3d58d22d0acf149e0dab2806fb1511d68a2bbefe61a3557.png" alt="å›¾ 16"></p>
<p><img src="/images/2024-12-31-811f8f1487604791fe13e5c727e0391f9c7debfab2423dc335fde8273212746f.png" alt="å›¾ 17"></p>
<p>åœ¨æµè§ˆå™¨ä¸­ï¼Œä¹Ÿä¼šå‡ºç°é”¯é½¿æ•ˆæœï¼Œä¸“ä¸šåè¯å«<code>&lt;font style=&quot;color:rgb(27, 27, 27);&quot;&gt;anti-aliasing effect&lt;/font&gt;</code><font style="color:rgb(27, 27, 27);"> , ä¸åŒçš„æµè§ˆå™¨æ¸²æŸ“å¼•æ“æœ‰ä¸åŒçš„è¡¨ç°ã€‚</font></p>
<p><img src="/images/2024-12-31-7a9fbcbc3dc4111e7eb57aa2a89ca0c36e364b100011964703244ff6823b0335.png" alt="å›¾ 18"></p>
<p>æµè§ˆå™¨å…è®¸æˆ‘ä»¬å†™å­åƒç´ ï¼Œä¹Ÿå°±æ˜¯ <code>width: 12px</code> <code>width: 12.3px</code> éƒ½èƒ½æ­£å¸¸æ¸²æŸ“ï¼Œæ¯ä¸€ä¸ªåƒç´ ç‚¹å¯ä»¥çœ‹åšä¸€ä¸ªæ­£æ–¹å½¢çš„æ ¼å­ï¼Œä¸€æ—¦æ–‡æœ¬è¾¹ç¼˜ä¸å†å¤„äºåƒç´ æ ¼ç½‘çš„æ•´æ•°ä½ç½®ï¼Œå°±ä¼šå‡ºç°é”¯é½¿ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ã€‚å¯¹<strong>åƒç´ è¿›è¡Œå–æ•´</strong>å³å¯ã€‚</p>
<p>å¯¹äº CSS å¯ä»¥å¼€å¯ <code>-webkit-font-smoothing</code> æ¥ä¼˜åŒ–</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.smoothed</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Canvas ä¸­å¯ä»¥å¼€å¯ <code>webkitImageSmoothingEnabled</code>æ¥ä¼˜åŒ–</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">ctx.webkitImageSmoothingEnabled = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸å¼€å¯æŠ—é”¯é½¿çš„è¯ï¼Œåœ¨ Canvas ä¸­è¿˜ä¼šå‡ºç°æŠ–åŠ¨çš„é—®é¢˜ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹æ–‡äº†è§£æ›´å¤š</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/lijinke/blog/wes11u?singleDoc#">Canvas æµ®ç‚¹æ•°åæ ‡é€ æˆæ–‡å­—æŠ–åŠ¨çš„é—®é¢˜</a></p>
<h3 id="S5rba">æ–‡æœ¬å®½é«˜æµ‹é‡ä¸å­—ä½“çš„å½±å“</h3>

<p>åœ¨è¡¨æ ¼æ¸²æŸ“ä¸­ï¼Œéœ€è¦æ¸²æŸ“å¤§é‡çš„æ–‡æœ¬ï¼Œéœ€è¦è®¡ç®—æ–‡æœ¬çš„å®½é«˜ç”¨äºå¸ƒå±€åæ ‡çš„è®¡ç®—ï¼Œä»è€Œå®ç°æ’ç‰ˆï¼Œå®½åº¦å—æµè§ˆå™¨çš„å­—ä½“å’Œç¬¦å·å½±å“</p>
<p>å¸¸è§çš„æ–‡æœ¬æœ‰æ±‰å­—ï¼Œæ•°å­—ï¼Œè‹±æ–‡ï¼Œç”šè‡³ <code>Emoji ğŸ˜¸</code>, Emoji é€šå¸¸æ˜¯ç”±å¤šä¸ª Unicode å­—ç¬¦ç»„æˆçš„å¤åˆå­—ç¬¦ï¼Œå®½åº¦å„ä¸ç›¸åŒï¼Œé‚£å¯¹äºè¿™ç§åœºæ™¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿è¯æµ‹é‡çš„å®½åº¦ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>[ç­‰å®½å­—ä½“](https://zh.wikipedia.org/zh-hans/%E7%AD%89%E5%AE%BD%E5%AD%97%E4%BD%93)</code></p>
<p><img src="/images/2024-12-31-b2cea509899a11666b3e2d3476c07fd306bfcf232b1b2863c6474c084f863f69.png" alt="å›¾ 19"><br><img src="/images/2024-12-31-cba70c4047295bce8a83a8b7f83bf4321e8c6e558a0d938884b365ec001c9d4e.png" alt="å›¾ 20"></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JetBrains Mono, Fira Code, Source Code Pro,Menlo,FiraCode-Medium,FiraCode-Light,FiraCode-Light,<span class="string">&#x27;Courier New&#x27;</span>, monospace</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;your-canvas-id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">ctx.font = <span class="string">&#x27;16px JetBrains Mono&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> text = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> textWidth = ctx.measureText(text).width;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Canvas Context çš„ <code>measureText</code>, è·å–åˆ° <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/TextMetrics">TextMetrics</a> åï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ç›¸åº”çš„å®½é«˜ï¼Œå¯¹äºç›¸åŒçš„æ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“å­˜èµ·æ¥ï¼Œæé«˜è®¡ç®—æ€§èƒ½</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> measureText = memoize(</span><br><span class="line">   (text: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>, <span class="attr">font</span>: unknown): TextMetrics | <span class="function"><span class="params">null</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (!font) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">const</span> ctx = <span class="built_in">this</span>.getCanvasElement()?.getContext(<span class="string">&#x27;2d&#x27;</span>)!;</span><br><span class="line">     <span class="keyword">const</span> &#123; fontSize, fontFamily, fontWeight, fontStyle, fontVariant &#125; =</span><br><span class="line">       font <span class="keyword">as</span> CSSStyleDeclaration;</span><br><span class="line"></span><br><span class="line">     ctx.font = [</span><br><span class="line">       fontStyle,</span><br><span class="line">       fontVariant,</span><br><span class="line">       fontWeight,</span><br><span class="line">       <span class="string">`<span class="subst">$&#123;fontSize&#125;</span>px`</span>,</span><br><span class="line">       fontFamily,</span><br><span class="line">     ]</span><br><span class="line">       .join(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">       .trim();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> ctx.measureText(<span class="built_in">String</span>(text));</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="function">(<span class="params">text, font</span>) =&gt;</span> [text, ...values(font)].join(<span class="string">&#x27;&#x27;</span>),</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> measureTextWidth = (</span><br><span class="line">   text: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   <span class="attr">font</span>: unknown,</span><br><span class="line"> ): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> textMetrics = <span class="built_in">this</span>.measureText(text, font);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> textMetrics?.width || <span class="number">0</span>;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> measureTextHeight = (</span><br><span class="line">   text: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   <span class="attr">font</span>: unknown,</span><br><span class="line"> ): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> textMetrics = <span class="built_in">this</span>.measureText(text, font);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!textMetrics) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     textMetrics.actualBoundingBoxAscent + textMetrics.actualBoundingBoxDescent</span><br><span class="line">   );</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="EWruh">ç¦»å± Canvas ä¸å­—ä½“çš„å½±å“</h3>

<p>é€šå¸¸æˆ‘ä»¬è¯´çš„ <code>ç¦»å± Canvas</code> æ˜¯æŒ‡æ²¡æœ‰ append åˆ° body ä¸Š ï¼ˆç”¨æˆ·ä¸å¯è§ï¼‰ çš„ <code>Canvas</code>, å®ƒå­˜åœ¨äºå†…å­˜ä¸­ï¼Œç”¨äºåšä¸€äº›å¤æ‚è®¡ç®—å’Œç»˜åˆ¶ï¼Œåœ¨å¤„ç†å®Œæˆåï¼Œå†ç»˜åˆ¶å›åŸæœ¬çš„ Canvas, ä»¥æå‡æ€§èƒ½</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> offscreenCanvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = offscreenCanvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç¦»å± Canvas ä¸Šè¿›è¡Œç»˜åˆ¶æ“ä½œ</span></span><br><span class="line">ctx.fillStyle = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">ctx.fillRect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠç¦»å± Canvas ç»˜åˆ¶åˆ°é¡µé¢å¯è§çš„ Canvas ä¸Š</span></span><br><span class="line"><span class="keyword">const</span> visibleCanvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;visibleCanvas&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> visibleCtx = visibleCanvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">visibleCtx.drawImage(offscreenCanvas, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç°ä»£æµè§ˆå™¨ä¹Ÿæä¾›ä¸€ä¸ªå®ç°æ€§çš„æ ‡å‡†å®ç° <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/OffscreenCanvas">OffscreenCanvas</a>, ç”±äºä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿™é‡Œç•¥è¿‡</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">myEntity.offscreenCanvas = document.createElement(&quot;canvas&quot;);</span><br><span class="line">myEntity.offscreenCanvas.width = myEntity.width;</span><br><span class="line">myEntity.offscreenCanvas.height = myEntity.height;</span><br><span class="line">myEntity.offscreenContext = myEntity.offscreenCanvas.getContext(&quot;2d&quot;);</span><br><span class="line"></span><br><span class="line">myEntity.render(myEntity.offscreenContext);</span><br></pre></td></tr></table></figure>

<p>ç”±äºç¦»å± Canvas ä¸å­˜åœ¨æ–‡æ¡£æµä¸­ï¼Œé‚£ä¹ˆä¹Ÿä¼šå‡ºç°æ–‡æœ¬å®½åº¦æµ‹é‡ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†å…¶æ·»åŠ åˆ° body ä¸­ ï¼ˆé»˜è®¤éšè—ï¼‰, å³å¯å¾—åˆ°ä¸€è‡´çš„å­—ä½“è¡¨ç°ã€‚</p>
<p><img src="/images/2024-12-31-1f885c962cc996040e0d217e39d4b12dfa575ac4fa6d1c388ab6f09bf6e8bae9.png" alt="å›¾ 21"></p>
<h3 id="M9QRd">æ–‡æœ¬æ— éšœç¢ä½“éªŒ</h3>
> æ— éšœç¢ï¼ˆAccessibilityï¼‰æ˜¯æŒ‡ä¸ºäººä»¬æä¾›å¹³ç­‰è®¿é—®ä¿¡æ¯ã€æœåŠ¡å’Œç¯å¢ƒçš„è®¾è®¡ç†å¿µå’Œå®è·µã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œæ— éšœç¢æ€§æ˜¯ç¡®ä¿æ‰€æœ‰äººï¼ŒåŒ…æ‹¬èº«ä½“æ®‹éšœã€è®¤çŸ¥éšœç¢å’Œæ„ŸçŸ¥éšœç¢çš„äººï¼Œéƒ½èƒ½å¤Ÿè·å¾—å’Œä½¿ç”¨ç½‘ç«™å’Œåº”ç”¨ç¨‹åºçš„èƒ½åŠ›ã€‚
>

<p>æ— éšœç¢ä½“éªŒç›®å‰è‹¹æœåšçš„æœ€å¥½ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œå¾ˆå¤šç»„ä»¶åº“ä¹Ÿåšäº†ä¸€äº›æ— éšœç¢çš„é€‚é…ï¼Œæ¯”å¦‚ Ant Design</p>
<p><img src="/images/2024-12-31-0461b29167511db4969277a8cc1a8fb56523c2046ccb2909f5a9bb3daa4340c0.png" alt="å›¾ 22"></p>
<p>å¯¹äºè¡¨æ ¼è¿™ç±»å¤§é‡æ–‡å­—çš„åœºæ™¯ï¼Œå¯¹äºä½¿ç”¨ Canvas çš„è¡¨æ ¼çš„ S2 æ¥è¯´æ˜¯ä¸€å¤§ç—›ç‚¹ï¼Œæ¯”å¦‚æ–‡å­—æ— æ³•è¢«é€‰ä¸­ï¼Œæ— æ³•è¢«é”®ç›˜è®¿é—®ï¼Œæ— æ³•æ·»åŠ  <code>aria</code> æ ‡ç­¾ï¼Œæ— æ³•è¢«æœç´¢ç­‰é—®é¢˜ã€‚åŒæ—¶å¯¹ SEO ä¹Ÿä¸å‹å¥½ã€‚</p>
<p><img src="/images/2024-12-31-8ea497cf4f533368f93a2aa9eb1342e30992e62bef43a93d13f827248ec8a857.png" alt="å›¾ 23"></p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Canvas çš„ä¸Šæ–¹æ·»åŠ  DOM è’™å±‚ï¼Œå¹¶è§£æ Canvas å†…çš„æ–‡æœ¬å…ƒç´ ï¼Œç»å¯¹å®šä½ä¸€ä¸ªç›¸åŒçš„ DOM ç‰ˆæœ¬çš„èŠ‚ç‚¹ï¼Œæå‡å¯è®¿é—®æ€§ï¼ŒG 5.0 æä¾›äº† <a target="_blank" rel="noopener" href="https://g.antv.antgroup.com/plugins/a11y">g-plugin-a11y</a> æ’ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°è¯¥èƒ½åŠ›ã€‚</p>
<p><img src="/images/2024-12-31-e9cb749fdb99f7707ced0eb7ce6611d0e411e26cc7fab6eeb7bea4fa1ace52fc.png" alt="å›¾ 24"></p>
<p><img src="/images/2024-12-31-19cb6061b382c41b4a383c2fcde61f4fe35b45a9c0462d919a91f425612a8561.png" alt="å›¾ 25"></p>
<h3 id="wARxj">å‚è€ƒæ–‡ç« </h3>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/570318956">å¼‚æ­¥åˆ†ç‰‡è®¡ç®—åœ¨è…¾è®¯æ–‡æ¡£çš„å®è·µ</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/608415829">æµ…è°ˆ Canvas æ¸²æŸ“å¼•æ“</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/517190133/answer/2354923121">ç”¨ Canvas å®ç°è™šæ‹Ÿåˆ—è¡¨çš„éš¾ç‚¹åœ¨å“ªé‡Œï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://seblee.me/2011/02/html5-canvas-sprite-optimisation/">html5-canvas-sprite-optimisation</a></p>
<p><a target="_blank" rel="noopener" href="https://johnresig.com/blog/sub-pixel-problems-in-css/">Sub-Pixel Problems in CSS</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35966107">ä¸ºä½• Canvas å†…å…ƒç´ åŠ¨ç”»æ€»æ˜¯åœ¨é¢¤æŠ–ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.html5rocks.com/en/tutorials/canvas/performance/">Improving HTML5 Canvas Performance</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas">Canvas çš„ä¼˜åŒ–</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/TR/css-text-4/#text-wrap">Text Wrapping</a></p>
<p><a target="_blank" rel="noopener" href="https://g.antv.antgroup.com/api/basic/text#%E5%A4%9A%E8%A1%8C%E5%B8%83%E5%B1%80">AntV/G å¤šè¡Œå¸ƒå±€</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/28855427">å•æœºæ¸¸æˆç”»é¢è®¾ç½®ä¸­çš„æŠ—é”¯é½¿æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç”»é¢ä¸­æœ‰é”¯é½¿åˆæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.woshipm.com/pd/4878303.html">æ— éšœç¢è®¾è®¡ä¸­çš„ç”¨æˆ·ä½“éªŒ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/antv/blog/ydsuqn">Canvas å±€éƒ¨æ¸²æŸ“ä¼˜åŒ–æ€»ç»“</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2024-12-31</span><i class="fa fa-comment-o"></i><a href="/2024/12/31/Canvas-%E6%96%87%E6%9C%AC%E6%B8%B2%E6%9F%93%E9%82%A3%E4%BA%9B%E4%BA%8B/#comments">è¯„è®º</a><i class="fa fa-tag"></i><a class="tag" href="/tags/Canvas/" title="Canvas">Canvas </a></div></div></div></div><div style="margin:30px"><span class="leancloud-visitors" id="/2024/12/31/Canvas-æ–‡æœ¬æ¸²æŸ“é‚£äº›äº‹/"><span class="post-meta-item-text" style="margin-right:5px">é˜…è¯»é‡</span><i class="leancloud-visitors-count">-</i></span></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://www.lijinke.cn/2024/12/31/Canvas-æ–‡æœ¬æ¸²æŸ“é‚£äº›äº‹/,æé‡‘ç‚çš„å°å±‹,Canvas æ–‡æœ¬æ¸²æŸ“é‚£äº›äº‹,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2023/12/21/Server-Sent-Events-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A8%E9%80%81/" title="Server-Sent Events æœåŠ¡ç«¯æ¨é€">ä¸‹ä¸€ç¯‡</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js?v=undefined"></script><script>var valine = new Valine({
  el:'#vcomments',
  //- notify: || false,
  //- verify:|| false,
  notify: true,
  verify: true,
  enableQQ: true,
  recordIP: true,
  app_id:'RBh7EcHesd4twgP5qIos38HM-gzGzoHsz',
  app_key:'f47a9Cg5ea9EVoPSs4KqfE6U',
  placeholder:'ç•™ä¸‹ç‚¹ä»€ä¹ˆ?',
  path: window.location.pathname,
  avatar:'robohash',
  visitor: true,
})</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="https://unpkg.com/darkreader@4.9.32/darkreader.js"></script><script src="/pwa.js"></script><script src="/main.js"></script></body></html>