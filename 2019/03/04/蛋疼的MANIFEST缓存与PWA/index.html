<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="李金珂,jkli@thoughtworks.com"><title> 蛋疼的MANIFEST缓存与PWA · 李金珂的小屋</title><meta name="description" content="1. 前言
这周有空 优化了下网站,

主要解决了 webpack 打包压缩 无效问题, 
升级 react-jinke-music-player 的版本 优化了体验
解决了缓存问题, 本文记录下这让人蛋疼的缓存

2. MANIFEST 离线缓存
不晓得是不是脑壳打铁, 网站上线到上周, 我一直用"><meta name="keywords" content="Javascript,Node.js"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/my.jpeg" style="width:127px;border-radius:50%;margin-bottom:20px;"><h3 title><a href="/">李金珂的小屋</a></h3><div class="description"><p>要想学仙术,哪能不吃苦</p></div></div></div><ul class="social-links"><li><a href="http://github.com/lijinke666"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">主页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友情链接</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/my.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a> 蛋疼的MANIFEST缓存与PWA</a></h3></div><div class="post-content"><h3 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h3><hr>
<p>这周有空 优化了下网站,</p>
<ul>
<li>主要解决了 <code>webpack</code> 打包压缩 无效问题, </li>
<li>升级 <code>react-jinke-music-player</code> 的版本 优化了体验</li>
<li>解决了缓存问题, 本文记录下这让人蛋疼的缓存</li>
</ul>
<h3 id="2-MANIFEST-离线缓存"><a href="#2-MANIFEST-离线缓存" class="headerlink" title="2. MANIFEST 离线缓存"></a>2. MANIFEST 离线缓存</h3><hr>
<p>不晓得是不是脑壳打铁, 网站上线到上周, 我一直用的是这个 <code>MANIFEST</code> 离线缓存, 听起来很酷炫</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">应用程序缓存为应用带来三个优势：</span><br><span class="line"></span><br><span class="line">- 离线浏览 - 用户可在应用离线时使用它们</span><br><span class="line">- 速度 - 已缓存资源加载得更快</span><br><span class="line">- 减少服务器负载 - 浏览器将只从服务器下载更新过或更改过的资源。</span><br></pre></td></tr></table></figure>
<p>其实一言难尽</p>
<p>首先新建一个 <code>xx.appcache</code> 的文件,比如像这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line">/theme.css</span><br><span class="line">/logo.gif</span><br><span class="line">/main.js</span><br></pre></td></tr></table></figure>
<p>由于webpack打包 加上了 hash值 我不可能写死, 所以自己又写了一个小工具去动态生成这个文件 <a href="https://github.com/lijinke666/add-static-cache-webpack-plugin" target="_blank" rel="noopener">地址</a></p>
<p>首先 新建一个 模板 <code>cacheTemp.tpl</code> ,本来还想缓存 音乐文件的,但是大小有限制, 就缓存了一些静态文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"># &#123;comments&#125;</span><br><span class="line"># &#123;date&#125;</span><br><span class="line">&#123;cssPath&#125;</span><br><span class="line">&#123;fontsPath&#125;</span><br><span class="line">&#123;imagesPath&#125;</span><br><span class="line"></span><br><span class="line">NETWORK:</span><br><span class="line">*</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> AddStaticCachePlugin = <span class="built_in">require</span>(<span class="string">'add-static-cache-webpack-plugin'</span>)</span><br><span class="line">...</span><br><span class="line">plugins:&#123;</span><br><span class="line">    <span class="keyword">new</span> AddStaticCachePlugin(&#123;</span><br><span class="line">      template:path.resolve(__dirname,<span class="string">'cacheTemp.tpl'</span>),</span><br><span class="line">      cacheName:<span class="string">"lijinkeWeb.appcache"</span>,            <span class="comment">//缓存文件名</span></span><br><span class="line">      comments:<span class="string">"lijinkeWeb appCache by add-static-cache-webpack-plugin"</span>,       <span class="comment">//注释</span></span><br><span class="line">      publicPath:<span class="string">"/"</span>                 <span class="comment">//公共路径</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后打包出来 差不多长这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"># lijinkeWeb appCache by add-static-cache-webpack-plugin</span><br><span class="line"># 2018/5/18 14:50:16</span><br><span class="line">/css/app.83131b52.css</span><br><span class="line"></span><br><span class="line">/fonts/iconfont500b2aa8.woff</span><br><span class="line">/fonts/iconfont66829b84.ttf</span><br><span class="line">/fonts/iconfont44844993.eot</span><br><span class="line">/fonts/iconfont07341295.svg</span><br><span class="line">/fonts/iconfonteb5d3623.svg</span><br><span class="line">/fonts/iconfontbf0fc2ec.woff</span><br><span class="line">/fonts/iconfont9ac2cc5a.ttf</span><br><span class="line">/fonts/iconfonte83ffaa9.eot</span><br><span class="line"></span><br><span class="line">/images/banner1942579a6.jpg</span><br><span class="line">/images/abouta8bf09c1.jpg</span><br><span class="line">/images/defaultc08c2bfe.jpeg</span><br><span class="line">/images/photo1cf8fcd45.jpg</span><br><span class="line">/images/photo14604a79ea.jpg</span><br><span class="line">/images/alipay6d19f782.jpg</span><br><span class="line">/images/cjmle2ee6fcf.png</span><br><span class="line">/images/githubf498d407.png</span><br><span class="line">/images/github_sedd18534.jpg</span><br><span class="line">/images/head_img6f56905f.jpg</span><br><span class="line">/images/head_img_s09e1d321.jpg</span><br><span class="line">/images/photo11ed311c75.jpg</span><br><span class="line">/images/photo11_sf1e4408a.jpg</span><br><span class="line">/images/photo125273802b.jpg</span><br><span class="line">/images/photo12_sd897ee4f.jpg</span><br><span class="line">/images/photo13395c0a40.jpg</span><br><span class="line">/images/photo13_s252b60c3.jpg</span><br><span class="line">/images/photo14_se2a642b2.jpg</span><br><span class="line">/images/photo159a29915b.jpg</span><br><span class="line">/images/photo15_sb7fd6059.jpg</span><br><span class="line">/images/photo17e9ac3071.jpg</span><br><span class="line">/images/photo17_s40a6a22e.jpg</span><br><span class="line">/images/photo188a6f8ea0.jpg</span><br><span class="line">/images/photo18_s60cc2f73.jpg</span><br><span class="line">/images/photo19189bbdb0.jpg</span><br><span class="line">/images/photo19_s07ae2e68.jpg</span><br><span class="line">/images/photo206d677fc1.jpg</span><br><span class="line">/images/photo20_sb599e88e.jpg</span><br><span class="line">/images/photo217c236744.jpg</span><br><span class="line">/images/photo21_s83e780e4.jpg</span><br><span class="line">/images/photo22cbef4c48.png</span><br><span class="line">/images/photo22_s5f1f372d.jpg</span><br><span class="line">/images/photo3ef6edcc5.jpg</span><br><span class="line">/images/photo43b47208f.jpg</span><br><span class="line">/images/photo54f4b8ab5.jpg</span><br><span class="line">/images/photo614dd11d3.jpg</span><br><span class="line">/images/photo77f33a9a7.jpg</span><br><span class="line">/images/photo897809533.jpg</span><br><span class="line">/images/weChatPayf7628413.png</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NETWORK:</span><br><span class="line">*</span><br></pre></td></tr></table></figure></p>
<p>然后在 index.html 里面引入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html manifest=&quot;lijinkeWeb.appcache&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>然并卵啊!!! ,首先 网站是  <code>SPA</code> 单页应用, 所谓的离线可访问 根本不现实, 文章页网络请求显示数据,每次更新 缓存时 ,还会阻塞 页面加载, 有时候网站还访问不了,要等它更新缓存完成之后 手动刷新才行,十分的蛋疼,目前的标准这个api已经被废弃.真实日了狗了…</p>
<h3 id="3-PWA"><a href="#3-PWA" class="headerlink" title="3. PWA"></a>3. PWA</h3><p>行嘛,这个不行嘛 我换一种嘛 , 用一种潮流的 <code>PWA</code> 渐进式webApp 总行了噻, 又是一番折腾,跟着网上的教程 撸了一遍<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局变量</span></span><br><span class="line"><span class="comment"> * self: 表示 Service Worker 作用域, 也是全局变量</span></span><br><span class="line"><span class="comment">    caches: 表示缓存</span></span><br><span class="line"><span class="comment">    skipWaiting: 表示强制当前处在 waiting 状态的脚本进入 activate 状态</span></span><br><span class="line"><span class="comment">    clients: 表示 Service Worker 接管的页面</span></span><br><span class="line"><span class="comment">    https://fed.renren.com/2017/10/08/service-worker-notification/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//缓存的key</span></span><br><span class="line"> <span class="keyword">const</span> cacheKey = <span class="string">"testKey2"</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//需要缓存的列表</span></span><br><span class="line"> <span class="keyword">const</span> cacheList = [</span><br><span class="line">     <span class="string">"/"</span>,</span><br><span class="line">     <span class="string">"index.html"</span>,</span><br><span class="line">     <span class="string">"index.css"</span>,</span><br><span class="line">     <span class="string">"fetch.json"</span>,</span><br><span class="line">     <span class="string">"demo.jpg"</span></span><br><span class="line"> ]</span><br><span class="line"></span><br><span class="line"> <span class="comment">//注册 安装 service worker 时  抓取资源 写入缓存</span></span><br><span class="line"> self.addEventListener(<span class="string">'install'</span>,(e)=&gt;&#123;</span><br><span class="line">     e.waitUntil(</span><br><span class="line">         caches.open(cacheKey)                                  <span class="comment">//将缓存写入在这个key中</span></span><br><span class="line">         .then( <span class="function">(<span class="params">cache</span>)=&gt;</span> cache.addAll(cacheList))</span><br><span class="line">         .then(<span class="function"><span class="params">()</span>=&gt;</span> self.skipWaiting())              <span class="comment">//停止等待 页面更新时  立即激活生效 service worker 脚本</span></span><br><span class="line">     )</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="comment">//网页赚取资源 service worker 可以捕获到 fetch 事件</span></span><br><span class="line"> self.addEventListener(<span class="string">'fetch'</span>,(e)=&gt;&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(e);</span><br><span class="line">     e.respondWith(</span><br><span class="line">       <span class="comment">//有请求来 先去缓存里找之前请求过没</span></span><br><span class="line">         caches.match(e.request).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">             <span class="built_in">console</span>.log(res);</span><br><span class="line">             <span class="keyword">if</span>(res != <span class="literal">null</span>) <span class="keyword">return</span> res          <span class="comment">//如果请求过 直接返回结果</span></span><br><span class="line">             <span class="keyword">return</span> fetch(e.request.url)         <span class="comment">//否则 继续请求</span></span><br><span class="line">         &#125;)</span><br><span class="line">     )</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">//更新静态资源</span></span><br><span class="line"> self.addEventListener(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.waitUntil(</span><br><span class="line">      <span class="built_in">Promise</span>.all(</span><br><span class="line">        caches.keys().then(<span class="function"><span class="params">cacheNames</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(cacheNames);</span><br><span class="line">          <span class="keyword">return</span> cacheNames.map(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (name !== cacheStorageKey) &#123;</span><br><span class="line">              <span class="keyword">return</span> caches.delete(name)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      ).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> self.clients.claim()             <span class="comment">//取得 页面控制权 页面会使用新更新的缓存</span></span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//接收推送消息</span></span><br><span class="line">self.addEventListener(<span class="string">'push'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> notificationData = event.data.json();</span><br><span class="line">    <span class="keyword">const</span> title = notificationData.title;</span><br><span class="line">    <span class="comment">// 弹消息框</span></span><br><span class="line">    event.waitUntil(self.registration.showNotification(title, notificationData));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//推送消息点击</span></span><br><span class="line">self.addEventListener(<span class="string">'notificationclick'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> notification = event.notification;</span><br><span class="line">    notification.close();</span><br><span class="line">    event.waitUntil(</span><br><span class="line">        clients.openWindow(notification.data.url)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>我想的有点多,想做一个 客户端的文章推送订阅, 然后把静态资源  通过 <code>server worker</code> 缓存起来, 结果要HTTPS 才行, 兼容性也比较差,就当学习了新知识</p>
<h3 id="4-manifest-json"><a href="#4-manifest-json" class="headerlink" title="4. manifest.json"></a>4. manifest.json</h3><p>虽然 server worker 没用起, 但是我给网站加上了 一个 简单炫酷的玩意, 也是 <code>PWA</code> 的一部分 , 这是一个描述文件 在pc 或者 手机时  可以在设置选择 <code>保存到桌面</code> 然后就可以得到 原生app 一样的体验 ,肥肠酷 ! 是不是很像 <code>electron</code> 打包出来的桌面应用呢?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//manifest.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;short_name&quot;: &quot;李金珂的小屋&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;李金珂的个人网站&quot;,</span><br><span class="line">    &quot;icons&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;src&quot;: &quot;/logos/logo_48.png&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;image/png&quot;,</span><br><span class="line">        &quot;sizes&quot;: &quot;48x48&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;src&quot;: &quot;/logos/logo_96.png&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;image/png&quot;,</span><br><span class="line">        &quot;sizes&quot;: &quot;96x96&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;src&quot;: &quot;/logos/logo_192.png&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;image/png&quot;,</span><br><span class="line">        &quot;sizes&quot;: &quot;192x192&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;src&quot;: &quot;/logos/logo_512.png&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;image/png&quot;,</span><br><span class="line">        &quot;sizes&quot;: &quot;512x512&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;start_url&quot;: &quot;/&quot;,</span><br><span class="line">    &quot;display&quot;: &quot;standalone&quot;,</span><br><span class="line">    &quot;background_color&quot;: &quot;#31c27c&quot;,</span><br><span class="line">    &quot;theme_color&quot;: &quot;#fff&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>导入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;manifest&quot; href=&quot;manifest.json&quot; crossorigin=&quot;use-credentials&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>效果<br><br><br><img src="https://lijinke666.github.io/lijinkeWeb-static/images/20180518151830.png" style="max-width:100%"><br><br><br><br><br><img src="https://lijinke666.github.io/lijinkeWeb-static/images/20180518151903.png" style="max-width:100%"><br><br></p>
<h3 id="5-弄些花里胡哨的东西-还是没缓存"><a href="#5-弄些花里胡哨的东西-还是没缓存" class="headerlink" title="5. 弄些花里胡哨的东西,还是没缓存"></a>5. 弄些花里胡哨的东西,还是没缓存</h3><hr>
<p>感觉 买了本 <code>图解HTTP</code> 来读 . 了解到  <code>Cache-Control</code> <code>max-age</code> 字段, 这是个 <code>HTTP/1.1</code> 的东东, 用来控制缓存的生命周期,也就是有效期, 第一次请求不会缓存,第二次 <code>Status Code:200 OK (from disk cache)</code> 可以看到已经将内容缓存在磁盘中. 到有效期到了后 浏览器 会再发一次请求 如果服务器告诉它没变化 就会返回 <code>304</code> 的状态码.表示没有修改.</p>
<h3 id="6-结语"><a href="#6-结语" class="headerlink" title="6. 结语"></a>6. 结语</h3><hr>
<p>多捞啊! 头皮发麻 这种简单的东西我都要搞这么久 其实归根结底还是要多看看基础知识的书! 不说了.工头叫我搬砖了</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-03-04</span><i class="fa fa-tag"></i><a class="tag" href="/tags/pwa/" title="pwa">pwa </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2019/03/04/蛋疼的MANIFEST缓存与PWA/,李金珂的小屋, 蛋疼的MANIFEST缓存与PWA,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/04/webpack4升级小记/" title=" webpack4升级小记">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/03/04/阳光灿烂的日子/" title="阳光灿烂的日子">下一篇</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js?v=undefined"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:true || false, 
  verify:true|| false, 
  app_id:'RBh7EcHesd4twgP5qIos38HM-gzGzoHsz',
  app_key:'f47a9Cg5ea9EVoPSs4KqfE6U',
  placeholder:'说点啥子',
  path: window.location.pathname,
  avatar:'monsterid'
})</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>